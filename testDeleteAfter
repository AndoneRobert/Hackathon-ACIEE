import cv2

# --- Setări ---
# Indexul camerei: 0 este prima cameră (USB sau CSI)
CAMERA_INDEX = 0 
WINDOW_NAME = 'MediaPipe/OpenCV Camera Test'

print(f"Incepere test CU CAMERA INDEX = {CAMERA_INDEX}")

# Inițializează obiectul de captură video
cap = cv2.VideoCapture(CAMERA_INDEX) 

if not cap.isOpened():
    print(f"Eroare: Nu s-a putut deschide camera la indexul {CAMERA_INDEX}. Încercați să schimbați indexul (0, 1, 2...).")
else:
    print(f"SUCCESS: Camera deschisa la indexul {CAMERA_INDEX}. Apăsați 'ESC' sau 'q' pentru a ieși.")
    
    # Creează fereastra în prealabil (pentru a preveni probleme de Null pointer)
    cv2.namedWindow(WINDOW_NAME, cv2.WINDOW_AUTOSIZE)

    while True:
        # 1. Citirea cadrului
        ret, frame = cap.read()
        
        if not ret:
            print("Eroare la citirea cadrului. Sursa video a fost pierdută.")
            break
            
        # 2. Afișează imaginea
        # Fereastra a fost creată deja cu cv2.namedWindow()
        cv2.imshow(WINDOW_NAME, frame)
        
        # 3. Verifică comanda de ieșire
        # waitKey(1) asigură că fereastra este actualizată
        key = cv2.waitKey(1) & 0xFF
        
        # Ieșire la apăsarea tastei 'q' sau 'ESC' (27)
        if key == ord('q') or key == 27:
            break

    # Eliberează resursele
    cap.release()
    cv2.destroyAllWindows()

# Sfat: Dacă folosești un Raspberry Pi 4/5, poți adăuga
# cap.set(cv2.CAP_PROP_FOURCC, cv2.VideoWriter_fourcc('M', 'J', 'P', 'G'))
# cap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)
# cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)
# chiar înainte de while True pentru a forța o rezoluție și a îmbunătăți performanța.
